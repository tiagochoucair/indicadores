<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/main.css"/>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <title></title>
</head>
<body data-ano="2015" data-mes="1" data-url="PromedioCiudad">
<div id="app">
    <div id="filtroCiudad_div" style="float:left; padding-right: 30px; padding-top: 30px"></div>
    <div id="filtroServicio_div" style="float:left; padding-right: 30px; padding-top: 30px"></div>
<div id="dashboard_div" style="border: 5px solid #ccc ; height: 100px;">
    <select name="anoSelect" id="anoSelect" style="float: right">
        <option value="2015">2015</option>
        <option value="2014">2014</option>
        <option value="2013">2013</option>
        <option value="2012">2012</option>
        <option value="2011">2011</option>
        <option value="2010">2010</option>
        <option value="2009">2009</option>
        <option value="2008">2008</option>
        <option value="2007">2007</option>
        <option value="2006">2006</option>
        <option value="2005">2005</option>
        <option value="2004">2004</option>
        <option value="2003">2003</option>
        <option value="2002">2002</option>
        <option value="2001">2001</option>
    </select>
    <select name="mesSelect" id="mesSelect"style="float: right">
        <option value="1">Enero</option>
        <option value="2">Febrero</option>
        <option value="3">Marzo</option>
        <option value="4">Abril</option>
        <option value="5">Mayo</option>
        <option value="6">Junio</option>
        <option value="7">Julio</option>
        <option value="8">Agosto</option>
        <option value="9">Septiembre</option>
        <option value="10">Octube</option>
        <option value="11">Noviembre</option>
        <option value="12">Diciembre</option>
    </select>
    <select name="ServicioSelect" id="ServicioSelect" style="float: right">
        <option label="Promedio" value="PromedioCiudad"></option>.
        <option label="HorasPorCargoPorCiudad" value="HorasCargoCiudad"></option>
        <option label="IndicesAnalista" value="IndicesAnalista"></option>
    </select>

</div>
<div class="mensaje"></div>

    <div id="chart_div" style="min-width: 250px"></div>

</div>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<script src="assets/jsrender.min.js"></script>
<script type="text/javascript">
    function searchToObject(urlSearch) {
        var pairs = urlSearch.substring(1).split("&"),
                obj = {},
                pair,
                i;

        for ( i in pairs ) {
            if ( pairs[i] === "" ) continue;

            pair = pairs[i].split("=");
            obj[ decodeURIComponent( pair[0] ) ] = decodeURIComponent( pair[1] );
        }

        return obj;
    }
    // Load the Visualization API and the piechart package.
    google.load('visualization', '1', {'packages':['corechart','controls','table']});
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawChart);

    $("#mesSelect").on("change", function(e){
        $.data(document.body, "mes", this.value);
        onChange();
    });

    $("#anoSelect").on("change", function(e){
        $.data(document.body, "ano", this.value);
        onChange();
    });

    $("#ServicioSelect").on("change", function(e){
        $.data(document.body, "url", this.value);
        onChange();
    });
    function onChange(){
        // actualizar el ano y mes
        var data = {
            ano: $.data(document.body, "ano"),
            mes: $.data(document.body, "mes"),
            url: $.data(document.body, "url")
        };

        drawChart(null, data.ano, data.mes, data.url);
        window.location.hash = "#?"+$.param(data);
        window.location.reload();
    }

    function drawChart(e, ano, mes, url) {
       // console.log(ano,mes);
        var ano = ano || 2015;
        var mes = mes || 1;
        var urls = url || "PromedioCiudad";
        var jsonData = $.ajax({
            url: "http://localhost:4000/api/"+urls,
            dataType:"json",
            data: {"ano": ano, "mes": mes}
        }).then(function(data, textStatus){
            changeService(urls);
            draw(data);
        }, function(xhr, textStatus){
            console.log("ERROR 123");
        });
    }

    $(document).ready(function(){
        var searchObj = searchToObject(window.location.hash.substring(1));
        changeService(searchObj.url);
        $("#mesSelect").val(searchObj.mes);
        $.data(document.body, "mes", searchObj.mes);
        $("#anoSelect").val(searchObj.ano);
        $.data(document.body, "ano", searchObj.ano);
        $("#ServicioSelect").val(searchObj.url);
        $.data(document.body, "url", searchObj.url);
        drawChart(null, searchObj.ano, searchObj.mes, searchObj.url);
    });

    function changeService(service){
        document.getElementById("serviceScript")
                .setAttribute("src","./assets/js/"+service+".js")
    }

</script>
<script id="serviceScript"></script>
<script>


</script>
</body>
</html>